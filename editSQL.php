<?php ob_start();session_start();$r=function(){header("Location:index.php");exit;};$f=$_POST['f']??$_GET['f']??'';if(!$f)$r();if(!($_SESSION['l']??0))((($_POST['u']??'')=='admin'&&($_POST['p']??'')=='admin')?($_SESSION['l']=1&&session_regenerate_id(1)):$r());try{$db=new PDO("sqlite:$f");$db->setAttribute(3,2);}catch(Exception$e){$r();}$T=$db->query("SELECT name FROM sqlite_master WHERE type='table'")->fetchAll(7);$tb=function($r,$n){if(!$r)return;echo"<b>$n</b><hr><div style=max-height:400px;overflow:auto><table border=1><tr><th>".join("</th><th>",array_keys($r[0]))."</th></tr>";foreach($r as$v)echo"<tr><td>".join("</td><td>",$v)."</td></tr>";echo"</table></div>";};if(($t=$_GET['x']??'')&&in_array($t,$T)){$d=$db->query("SELECT * FROM $t")->fetchAll(2);$j=($_GET['y']??'')=='j';header('Content-Type:'.($j?'application/json':'text/csv'));header("Content-Disposition:attachment;filename=$t.".($j?"json":"csv"));if($j)echo json_encode($d,448|256);else{$o=fopen('php://output','w');fputcsv($o,array_keys($d[0]??[]),",",'"',"\\");foreach($d as$r)fputcsv($o,$r,",",'"',"\\");}exit;}foreach($T as$t)if($t!='sqlite_sequence')echo"<a href=?f=$f&t=$t>$t</a><hr>";if(($t=$_GET['t']??($_SESSION['lb']??''))&&in_array($t,$T)){try{$r=$db->query("SELECT * FROM $t")->fetchAll(2);$tb($r?:$db->query("PRAGMA table_info($t)")->fetchAll(2),$t);echo"<hr><a href=?f=$f&x=$t&y=j>JSON</a>|<a href=?f=$f&x=$t&y=c>CSV</a>";}catch(Exception$e){echo$e->getMessage();}}if(!empty($_POST['c'])){$_SESSION['c']=$sql=$_POST['c'];$e='';try{if(($s=$db->query($sql))instanceof PDOStatement&&preg_match('/^(INSERT|UPDATE|DELETE)\s+(?:INTO|FROM)?\s*["`]?(?<t>[a-z0-9_]+)["`]?/i',$sql,$m))$_SESSION['lb']=$m['t'];$_SESSION['h'][]=$sql;}catch(Exception$x){$e=$x->getMessage();}if($e)echo"<br>$e";else{header("Location:?f=$f&run=1");exit;}}if(isset($_GET['z']))$_SESSION['c']='';?><form method=post onsubmit="return c()"><textarea name=c id=c rows=10 cols=50 required><?=htmlspecialchars($_SESSION['c']??'')?></textarea><br><input type=hidden name=f value="<?=$f?>"><input type=submit > <a href="?f=<?=$f?>&z=1"> Clear</a></form><script>function c(){let c=document.querySelector('#c').value.toUpperCase(),p=['DROP','DELETE','VACUUM','TRUNCATE','UPDATE','REPLACE','ALTER','ATTACH','DETACH'];return p.some(x=>c.includes(x))?confirm("cmd: "+c+" Perigoso"):1;}</script><textarea readonly rows=10 cols=50><?php if(!empty($_SESSION['h']))foreach(array_slice(array_reverse($_SESSION['h']),-500)as$h)echo"$h\n\n";ob_end_flush();?></textarea>